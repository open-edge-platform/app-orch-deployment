# SPDX-FileCopyrightText: (C) 2025 Intel Corporation
# SPDX-License-Identifier: Apache-2.0
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: apiextensions.app.edge-orchestrator.intel.com
spec:
  group: app.edge-orchestrator.intel.com
  names:
    kind: APIExtension
    listKind: APIExtensionList
    plural: apiextensions
    shortNames:
    - apie
    singular: apiextension
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Display name of the API extension
      jsonPath: .spec.displayName
      name: Display Name
      type: string
    - jsonPath: .status.state
      name: State
      type: string
    - jsonPath: .status.display
      name: Status
      type: string
    - jsonPath: .status.message
      name: Message
      type: string
    - description: Applied API endpoint URLs
      jsonPath: .status.appliedApiEndpoints
      name: Endpoints
      type: string
    - description: Age of this resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: APIExtension is the Schema for the apiextensions API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              APIExtensionSpec defines the desired state of APIExtension
              GUI is optional for API extension
            properties:
              agentClusterLabels:
                additionalProperties:
                  type: string
                description: |-
                  AgentTargetClusters define the cluster labels for selecting clusters
                  to deploy API Agent service
                type: object
              apiGroup:
                description: APIGroup defines the API collection to be extended
                properties:
                  name:
                    description: |-
                      Name defines the name of the API connection to be extended
                      It is used to generate the path in the external URL for extended API
                      access, so must be unique
                    type: string
                  version:
                    description: Version defines the API group version
                    type: string
                required:
                - name
                - version
                type: object
              displayName:
                description: DisplayName is the display name of this API extension
                type: string
              project:
                description: Project refers to the owner project of this API extension
                type: string
              proxyEndpoints:
                description: |-
                  ProxyEndpoints defines proxy and target endpoints required to configure
                  API gateway and API Proxy Service to route extended API calls to the
                  backend services
                items:
                  description: ProxyEndpoint has endpoint information for proxy
                  properties:
                    appName:
                      description: AppName indicates the target application name
                      type: string
                    authType:
                      description: AuthType defines the auth protocol (tls, mtls or
                        insecure) for the backend service
                      type: string
                    backend:
                      description: |-
                        Backend defines the backend service URL that API Proxy and Agent to
                        interacts with
                      type: string
                    path:
                      description: |-
                        Path defines the path that follows the API group name and version in the
                        external URL to identify the backend service
                      type: string
                    scheme:
                      description: Scheme defines the protocol scheme (http or https)
                        for the backend service
                      type: string
                    serviceName:
                      description: ServiceName defines the name of the service to
                        proxy
                      type: string
                  required:
                  - appName
                  - authType
                  - backend
                  - path
                  - scheme
                  - serviceName
                  type: object
                type: array
              uiExtensions:
                description: UIExtensions defines UI Extensions for API Extension
                items:
                  description: UIExtension is the schema for UI extension
                  properties:
                    appName:
                      description: The name of the application corresponding to this
                        UI extension.
                      type: string
                    description:
                      description: Description states the purpose of the dashboard
                        that this UIExtension represents.
                      type: string
                    fileName:
                      description: The name of the main file to load this specific
                        UI extension.
                      type: string
                    label:
                      description: Label represents a dashboard in the main UI.
                      type: string
                    moduleName:
                      description: The application module to be loaded.
                      type: string
                    serviceName:
                      description: ServiceName corresponds to ServiceName in ProxyEndpoint
                        and refers to the name of the service to proxy.
                      type: string
                  required:
                  - appName
                  - description
                  - fileName
                  - label
                  - moduleName
                  - serviceName
                  type: object
                type: array
            required:
            - agentClusterLabels
            - apiGroup
            - displayName
            - project
            - proxyEndpoints
            type: object
          status:
            description: APIExtensionStatus defines the observed state of APIExtension
            properties:
              appliedApiEndpoints:
                description: A list of applied API endpoints
                items:
                  type: string
                type: array
              conditions:
                description: Conditions is a list conditions that describe the state
                  of the Grafana extension CR
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              display:
                description: A string to display in the CLI
                type: string
              message:
                description: An informative error message if State is Down
                type: string
              observedGeneration:
                description: ObservedGeneration is the latest generation observed
                  by the controller
                format: int64
                type: integer
              state:
                description: The state of the API Extension (Running / Down)
                type: string
              tokenSecretRef:
                description: A reference of Token secret
                properties:
                  name:
                    description: Name of the secret used to store an auth token
                    type: string
                  timestamp:
                    description: Timestamp when token was generated
                    type: string
                  token:
                    description: |-
                      GeneratedToken is used to recreate the secret in case
                      when the secret is deleted.
                    type: string
                type: object
            required:
            - state
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
